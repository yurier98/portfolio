const x=[[/^(<!--)(.+)(-->)$/,!1],[/^(\/\*)(.+)(\*\/)$/,!1],[/^(\/\/|["'#]|;{1,2}|%{1,2}|--)(.*)$/,!0],[/^(\*)(.+)$/,!0]];function k(e,i,n){const l=[];for(const r of e){if(n==="v3"){const s=r.children.flatMap((o,t)=>{if(o.type!=="element")return o;const f=o.children[0];if(f.type!=="text")return o;const a=t===r.children.length-1;if(!y(f.value,a))return o;const u=f.value.split(/(\s+\/\/)/);if(u.length<=1)return o;let g=[u[0]];for(let d=1;d<u.length;d+=2)g.push(u[d]+(u[d+1]||""));return g=g.filter(Boolean),g.length<=1?o:g.map(d=>({...o,children:[{type:"text",value:d}]}))});s.length!==r.children.length&&(r.children=s)}const c=r.children;let m=c.length-1;n==="v1"?m=0:i&&(m=c.length-2);for(let s=Math.max(m,0);s<c.length;s++){const o=c[s];if(o.type!=="element")continue;const t=o.children.at(0);if((t==null?void 0:t.type)!=="text")continue;const f=s===c.length-1,a=y(t.value,f);if(a)if(i&&!f&&s!==0){const h=v(c[s-1],"{")&&v(c[s+1],"}");l.push({info:a,line:r,token:o,isLineCommentOnly:c.length===3&&o.children.length===1,isJsxStyle:h})}else l.push({info:a,line:r,token:o,isLineCommentOnly:c.length===1&&o.children.length===1,isJsxStyle:!1})}}return l}function v(e,i){if(e.type!=="element")return!1;const n=e.children[0];return n.type!=="text"?!1:n.value.trim()===i}function y(e,i){let n=e.trimStart();const l=e.length-n.length;n=n.trimEnd();const r=e.length-n.length-l;for(const[c,m]of x){if(m&&!i)continue;const s=c.exec(n);if(s)return[" ".repeat(l)+s[1],s[2],s[3]?s[3]+" ".repeat(r):void 0]}}function A(e){const i=e.match(/(?:\/\/|["'#]|;{1,2}|%{1,2}|--)(\s*)$/);return i&&i[1].trim().length===0?e.slice(0,i.index):e}function C(e,i,n,l){return l==null&&(l="v3"),{name:e,code(r){const c=r.children.filter(t=>t.type==="element"),m=[];r.data??(r.data={});const s=r.data;s._shiki_notation??(s._shiki_notation=k(c,["jsx","tsx"].includes(this.options.lang),l));const o=s._shiki_notation;for(const t of o){if(t.info[1].length===0)continue;let f=c.indexOf(t.line);t.isLineCommentOnly&&l!=="v1"&&f++;let a=!1;if(t.info[1]=t.info[1].replace(i,(...u)=>n.call(this,u,t.line,t.token,c,f)?(a=!0,""):u[0]),!a)continue;l==="v1"&&(t.info[1]=A(t.info[1]));const h=t.info[1].trim().length===0;if(h&&(t.info[1]=""),h&&t.isLineCommentOnly)m.push(t.line);else if(h&&t.isJsxStyle)t.line.children.splice(t.line.children.indexOf(t.token)-1,3);else if(h)t.line.children.splice(t.line.children.indexOf(t.token),1);else{const u=t.token.children[0];u.type==="text"&&(u.value=t.info.join(""))}}for(const t of m){const f=r.children.indexOf(t),a=r.children[f+1];let h=1;(a==null?void 0:a.type)==="text"&&(a==null?void 0:a.value)===`
`&&(h=2),r.children.splice(f,h)}}}}function L(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function p(e={},i="@shikijs/transformers:notation-map"){const{classMap:n={},classActivePre:l=void 0}=e;return C(i,new RegExp(`\\s*\\[!code (${Object.keys(n).map(L).join("|")})(:\\d+)?\\]`),function([r,c,m=":1"],s,o,t,f){const a=Number.parseInt(m.slice(1),10);for(let h=f;h<Math.min(f+a,t.length);h++)this.addClassToHast(t[h],n[c]);return l&&this.addClassToHast(this.pre,l),!0},e.matchAlgorithm)}function O(e={}){const{classLineAdd:i="diff add",classLineRemove:n="diff remove",classActivePre:l="has-diff"}=e;return p({classMap:{"++":i,"--":n},classActivePre:l,matchAlgorithm:e.matchAlgorithm},"@shikijs/transformers:notation-diff")}function M(e={}){const{classMap:i={error:["highlighted","error"],warning:["highlighted","warning"]},classActivePre:n="has-highlighted"}=e;return p({classMap:i,classActivePre:n,matchAlgorithm:e.matchAlgorithm},"@shikijs/transformers:notation-error-level")}function j(e={}){const{classActiveLine:i="focused",classActivePre:n="has-focused"}=e;return p({classMap:{focus:i},classActivePre:n,matchAlgorithm:e.matchAlgorithm},"@shikijs/transformers:notation-focus")}function E(e={}){const{classActiveLine:i="highlighted",classActivePre:n="has-highlighted"}=e;return p({classMap:{highlight:i,hl:i},classActivePre:n,matchAlgorithm:e.matchAlgorithm},"@shikijs/transformers:notation-highlight")}export{C as createCommentNotationTransformer,O as transformerNotationDiff,M as transformerNotationErrorLevel,j as transformerNotationFocus,E as transformerNotationHighlight,p as transformerNotationMap};
